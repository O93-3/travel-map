<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Travel Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.json">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="./vendor/leaflet/leaflet.css">
  <!-- Base styles -->
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./style.themes.css">
  <!-- Overrides / add-ons (load AFTER style.css) -->
  <link rel="stylesheet" href="./style.cityresults.fix.css">
  <link rel="stylesheet" href="./style.overlay.fontsize.all.css">
  <link rel="stylesheet" href="./style.routeoverlay.drag.css">
  <link rel="stylesheet" href="./style.overlay.readability.css">
  <link rel="stylesheet" href="./style.routeoverlay.modern.css">
  <link rel="stylesheet" href="./style.citylabels.css">
  <link rel="stylesheet" href="./style.unified.overlay.css">
</head>
<body data-theme="neon">
  <div id="map"></div>
  <div id="tmOverlayStage" aria-hidden="true">
    <div id="tmOverlayCard" class="tm-ov-box" role="group" aria-label="Overlay card">
      <div class="tm-ov-card">
        <div class="tm-ov-head">
          <div class="tm-ov-title">TRAVEL</div>
          <div id="tmOvDistance" class="tm-ov-distance">- km</div>
        </div>

        <div class="tm-ov-row">
          <div class="tm-ov-tagwrap"><div class="tm-ov-tag to">TO</div></div>
          <img id="tmOvToFlag" class="tm-ov-flag" alt="flag">
          <div class="tm-ov-place">
            <div id="tmOvToCountry" class="tm-ov-country">-</div>
            <div id="tmOvToCity" class="tm-ov-city">-</div>
          </div>
        </div>

        <div class="tm-ov-row">
          <div class="tm-ov-tagwrap"><div class="tm-ov-tag from">FROM</div></div>
          <img id="tmOvFromFlag" class="tm-ov-flag" alt="flag">
          <div class="tm-ov-place">
            <div id="tmOvFromCountry" class="tm-ov-country">-</div>
            <div id="tmOvFromCity" class="tm-ov-city">-</div>
          </div>
        </div>

        <div id="tmOvEmpty" class="tm-ov-empty">※ ルートがまだありません（2地点を追加してください）</div>
      </div>
    </div>

    <div id="tmOverlayMap" class="tm-ov-box" role="group" aria-label="Overlay map">
      <div class="tm-ov-mapframe">
        <div id="tmOvMiniMap"></div>
        <div id="tmOvMapError" class="tm-ov-maperror">ミニマップの初期化に失敗しました。<br>（Consoleを確認）</div>
      </div>
    </div>

    <div id="tmOverlayAdjustPanel" aria-hidden="true">
      <div class="tm-ovp-head">
        <div class="tm-ovp-title">オーバーレイ調整</div>
        <button id="tmOvClose" type="button" class="tm-ovp-close">閉じる（ESC）</button>
      </div>

      <div class="tm-ovp-body">
        <div class="tm-ovp-sec">
          <div class="tm-ovp-sec-title">共通</div>
          <label class="tm-ovp-row"><span>テーマ</span>
            <select id="tmOvThemeSel">
              <option value="neon">NEON</option>
              <option value="amber">AMBER</option>
              <option value="lime">LIME</option>
              <option value="violet">VIOLET</option>
              <option value="mono">MONO</option>
            </select>
          </label>
          <label class="tm-ovp-row"><span>フォント</span>
            <select id="tmOvFontSel">
              <option value="yugothic">游ゴシック</option>
              <option value="meiryo">メイリオ</option>
              <option value="bizud">BIZ UD</option>
              <option value="msgothic">MSゴシック</option>
              <option value="noto">Noto Sans JP</option>
            </select>
          </label>
          <label class="tm-ovp-row"><span>カード表示</span><input id="tmOvShowCard" type="checkbox" checked></label>
          <label class="tm-ovp-row"><span>ミニマップ表示</span><input id="tmOvShowMap" type="checkbox" checked></label>
          <label class="tm-ovp-row"><span>枠表示</span><input id="tmOvShowFrame" type="checkbox" checked></label>
          <label class="tm-ovp-row"><span>枠の太さ</span><input id="tmOvBorderW" type="range" min="0" max="6" step="1" value="2"></label>
        </div>

        <div class="tm-ovp-sec">
          <div class="tm-ovp-sec-title">カード</div>
          <label class="tm-ovp-row"><span>横幅</span><input id="tmOvCardW" type="range" min="260" max="560" step="1" value="320"></label>
          <label class="tm-ovp-row"><span>縦幅</span><input id="tmOvCardH" type="range" min="0" max="460" step="1" value="0"></label>
          <label class="tm-ovp-row"><span>TRAVEL/距離サイズ</span><input id="tmOvHeadScale" type="range" min="0.80" max="1.60" step="0.01" value="1.00"></label>
          <label class="tm-ovp-row"><span>全体</span><input id="tmOvCardScale" type="range" min="0.60" max="1.40" step="0.01" value="1.00"></label>
          <label class="tm-ovp-row"><span>都市名</span><input id="tmOvCitySize" type="range" min="14" max="44" step="1" value="32"></label>
          <label class="tm-ovp-row"><span>国名</span><input id="tmOvCountrySize" type="range" min="12" max="28" step="1" value="16"></label>
          <label class="tm-ovp-row"><span>旗</span><input id="tmOvFlagH" type="range" min="16" max="64" step="1" value="42"></label>
        </div>

        <div class="tm-ovp-sec">
          <div class="tm-ovp-sec-title">ミニマップ</div>
          <label class="tm-ovp-row"><span>地図種類</span>
            <select id="tmOvMapStyleSel">
              <option value="bw">白黒</option>
              <option value="osm">標準</option>
              <option value="topo">Topo</option>
              <option value="sat">衛星</option>
            </select>
          </label>
          <label class="tm-ovp-row"><span>横幅</span><input id="tmOvMapW" type="range" min="360" max="820" step="1" value="480"></label>
          <label class="tm-ovp-row"><span>縦幅</span><input id="tmOvMapH" type="range" min="180" max="520" step="1" value="255"></label>
          <label class="tm-ovp-row"><span>全体</span><input id="tmOvMapScale" type="range" min="0.60" max="1.60" step="0.01" value="1.00"></label>
          <label class="tm-ovp-row"><span>地名サイズ</span><input id="tmOvMapLabelSize" type="range" min="10" max="20" step="1" value="12"></label>
          <label class="tm-ovp-row"><span>ピンサイズ</span><input id="tmOvPin" type="range" min="4" max="20" step="1" value="12"></label>
        </div>

        <div class="tm-ovp-hint">※ 調整モード中はカード/ミニマップをドラッグして位置を決められます（自動保存）。</div>
      </div>
    </div>
  </div>

  <button id="uiToggle" class="ui-toggle" type="button" aria-label="メニュー" aria-expanded="false">☰</button>
  <!-- 現在地表示（ドラッグ可） -->
  <div id="currentLocation">
    <img id="flag" alt="flag">
    <div id="currentText">
      <span id="currentCountry">日本 (JP)</span>
      <span id="currentCity">神戸</span>
    </div>
  </div>

  <!-- 配信インジケータ -->
  <div id="streamIndicator"><span class="dot"></span> LIVE</div>

  <!-- OBS Route Overlay -->
  <div id="routeOverlay">
    <div class="ro-head"><div class="ro-title">ROUTE</div><div id="roProgress" class="ro-progress">0/0</div></div>
    <div class="ro-main">
      <div class="ro-block">
        <div class="ro-line1"><div class="ro-label">NOW</div><div id="roNowCity" class="ro-value">-</div></div>
        <div class="ro-line2"><img id="roNowFlag" class="ro-flag" alt="flag"><div id="roNowCountry" class="ro-country">-</div></div>
      </div>
      <div class="ro-block">
        <div class="ro-line1"><div class="ro-label">FROM</div><div id="roFromCity" class="ro-value">-</div></div>
        <div class="ro-line2"><img id="roFromFlag" class="ro-flag" alt="flag"><div id="roFromCountry" class="ro-country">-</div></div>
      </div>
      <div id="roHistory" class="ro-history"></div>
    </div>
  </div>

  
  <div id="ui">
<button id="langBtn">日本語</button>
    <button id="streamBtn">配信モード</button>
    <button id="overlayAdjustBtn" class="sub">オーバーレイ調整</button>
    <details class="ui-group"><summary class="ui-title">デザイン</summary>
      <label class="col"><span>テーマ</span>
        <select id="themeSelect">
          <option value="neon">NEON</option>
          <option value="graphite">GRAPHITE</option>
          <option value="sunset">SUNSET</option>
        </select>
      </label>

      <label class="col"><span>都市名ラベル（地図上）</span>
        <select id="cityLabelMode">
          <option value="off">OFF</option>
          <option value="route">ルート（FROM/TOのみ）</option>
          <option value="all">履歴すべて</option>
        </select>
      </label>
      <label class="col"><span>都市名ラベルサイズ</span>
        <input id="cityLabelSize" type="range" min="8" max="24" step="1" value="12">
      </label>
      <div class="hint" style="opacity:.75;font-size:12px;margin-top:6px;">※配色のみ切替（保存されます）</div>
      <div class="hint" style="opacity:.75;font-size:12px;margin-top:6px;">OBS用: <code>overlay.html</code>（1200×320 / 透明）</div>
    </details>


    <details class="ui-group"><summary class="ui-title">現在の状態</summary>
      <button id="exportBtn">現在の状態を保存</button>
      <button id="importBtn">保存した状態を読み込み</button>
      <input id="importFile" type="file" accept="application/json" style="display:none">
    </details>

    <!-- ルート（検索を最上段へ） -->
    <details class="ui-group"><summary class="ui-title">地図</summary>
      <select id="mapStyleSelect">
        <option value="osm">標準</option>
        <option value="bw">白黒</option>
        <option value="sat">衛星</option>
        <option value="topo">地形</option>
      </select>
      <button id="toggleBorders">国境色分け ON/OFF</button>
    </details>

<details class="ui-group"><summary class="ui-title">ルート</summary>
      <!-- 検索を最上段へ配置 -->
      <div class="searchWrap" style="margin-bottom:8px;">
        <input id="citySearch" placeholder="都市名・国名で検索">
        <div id="cityResults" class="city-results"></div>
      </div>


      <!-- 地域／国／州（ATS） -->
      <select id="regionSelect"><option value="">地域</option></select>
      <select id="countrySelect"><option value="">国</option></select>
      <div class="stateWrap" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <select id="stateSelect"><option value="">州</option></select>
      </div>


      <!-- 地域／国セレクト -->
<!-- 都市セレクト／操作 -->
      <select id="citySelect"><option value="">都市</option></select>
      <button id="addBtn">追加</button>
      <button id="undoBtn">ひとつ戻す</button>
      <button id="cancelInsertBtn">挿入解除</button>
      <div>挿入モード: <span id="insertModeLabel">OFF</span></div>
      <ol id="routeList" class="route-list"></ol>
      <button id="resetHistoryBtn" class="danger">ルート履歴をリセット</button>
    </details>

    

    <details class="ui-group"><summary class="ui-title">現在地</summary>
      <label><input id="showLocation" type="checkbox" checked> 現在地表示</label>
      <button id="lockLocationBtn">位置ロック: OFF</button>
      <label class="col"><span>現在地マーカーサイズ</span><input id="currentMarkerSize" type="range" min="8" max="60" value="20"></label>
      <label class="col"><span>現在地テキストサイズ</span><input id="locFontSize" type="range" min="12" max="40" value="18"></label>
      <label class="col"><span>旗サイズ</span><input id="locFlagSize" type="range" min="12" max="96" value="24"></label>
      <label class="col"><span>パディング</span><input id="locPadding" type="range" min="4" max="40" value="10"></label>
      <label class="col"><span>ルート線の色</span><input id="lineColor" type="color" value="#ff3333"></label>
      <label class="col"><span>ルート線の太さ</span><input id="lineWeight" type="range" min="1" max="12" value="4"></label>
      <label class="col"><span>現在地マーカー色</span><input id="currentMarkerColor" type="color" value="#00ffff"></label>
      <label class="col"><span>過去マーカー色</span><input id="pastMarkerColor" type="color" value="#ff3333"></label>
      <label class="col"><span>現在地マーカー明滅</span><input id="blinkCurrentMarker" type="checkbox" checked></label>
      <label class="col"><span>現在地 不透明度</span>
        <input id="locOpacity" type="range" min="0.60" max="1.00" step="0.01" value="1.00">
      </label>
      <label class="col"><span>現在地 背景の透過度</span>
        <input id="locBgAlpha" type="range" min="0.30" max="0.90" step="0.01" value="0.55">
      </label>
      <label class="col"><span>現在地 行間（ラインハイト）</span>
        <input id="locLineHeight" type="range" min="1.00" max="1.50" step="0.01" value="1.10">
      </label>
    </details>

    <details class="ui-group"><summary class="ui-title">ルートオーバーレイ</summary>
      <label><input id="showRouteOverlay" type="checkbox" checked> オーバーレイ表示</label>
      <label class="col"><span>オーバーレイ文字サイズ</span><input id="overlayFontSize" type="range" min="12" max="40" value="18"></label>
      <label class="col"><span>国旗サイズ</span><input id="overlayFlagSize" type="range" min="12" max="96" value="22"></label>
      <label><input id="overlayOnlyInStream" type="checkbox"> 配信モード中のみ表示</label>
      <!-- 見やすさ（不透明度／背景透過／行間） -->
      <label class="col"><span>オーバーレイ不透明度</span>
        <input id="overlayOpacity" type="range" min="0.60" max="1.00" step="0.01" value="1.00">
      </label>
      <label class="col"><span>背景の透過度</span>
        <input id="overlayBgAlpha" type="range" min="0.30" max="0.90" step="0.01" value="0.62">
      </label>
      <label class="col"><span>行間（ラインハイト）</span>
        <input id="overlayLineHeight" type="range" min="1.00" max="1.50" step="0.01" value="1.10">
      </label>
    </details>
  </div>

  <!-- Scripts -->
  <script src="./vendor/leaflet/leaflet.js"></script>
  <script src="./js/map-hook.js"></script>
  <script src="./app.js"></script>
  <script src="./js/overlay-unified.js"></script>
  <script src=\"./js/overlay-settings.js\"></script>
  <script src="./js/fix-currentlocation-drag.js"></script>
  <script src="./js/ui-drawer.js"></script>
<script src="./js/extensions.js"></script>
  <script src="./js/selfcheck.js"></script>
  <!-- Safe add-ons (app.jsは不変のまま機能追加) -->
  <script src="./js/fix-lineweight.js"></script>
  <script src="./js/draggable-routeoverlay.js"></script>
  <script src="./js/overlay-fontsize.all.js"></script>
  <script src="./js/overlay-readability.js"></script>
  <script src="./js/location-readability.js"></script>
  <script src="./js/custom-blink.js"></script>
  <script src="./js/theme-picker.js"></script>
  <script src="./js/city-labels.js"></script>


    <details class="ui-group" id="obsOverlaySettings">
      <summary>OBS Overlay</summary>
      <div class="ui-row"><label>カード背景</label><input type="color" id="ovCardBg" value="#0a0c12"></div>
      <div class="ui-row"><label>カード枠色</label><input type="color" id="ovCardBorder" value="#ffffff"></div>
      <div class="ui-row"><label>枠太さ</label><input type="range" id="ovCardBorderW" min="1" max="4" step="1" value="2"></div>
      <div class="ui-row"><label>文字色</label><input type="color" id="ovText" value="#ffffff"></div>
      <div class="ui-row"><label>補助文字色</label><input type="color" id="ovMuted" value="#cfd3dd"></div>
      <div class="ui-row"><label>FROM色</label><input type="color" id="ovFrom" value="#00e5ff"></div>
      <div class="ui-row"><label>TO色（オレンジ）</label><input type="color" id="ovTo" value="#ffb020"></div>
      <div class="ui-row"><label>旗サイズ</label><input type="range" id="ovFlagW" min="32" max="64" step="1" value="42"></div>
      <div class="ui-row"><label>国名サイズ</label><input type="range" id="ovCountrySize" min="14" max="26" step="1" value="18"></div>
      <div class="ui-row"><label>都市サイズ</label><input type="range" id="ovCitySize" min="22" max="44" step="1" value="32"></div>
      <div class="ui-row"><label>行間（都市）</label><input type="range" id="ovCityLH" min="1.00" max="1.25" step="0.01" value="1.08"></div>
      <div class="ui-row"><label>距離サイズ</label><input type="range" id="ovDistanceSize" min="16" max="28" step="1" value="20"></div>
      <div class="ui-row"><label>行の間隔</label><input type="range" id="ovRowGap" min="8" max="16" step="1" value="10"></div>
      <div class="ui-row"><label>上下マージン</label><input type="range" id="ovRowMY" min="8" max="16" step="1" value="10"></div>
      <div class="ui-hint">※ レイアウト崩れ防止のため、過度に小さい値は自動で下限に丸めます。</div>
    </details>

</body>
</html>
