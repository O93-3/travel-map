<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Travel Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.json">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <!-- Base styles -->
  <link rel="stylesheet" href="./style.css">
  <!-- Overrides / add-ons (load AFTER style.css) -->
  <link rel="stylesheet" href="./style.cityresults.fix.css">
  <link rel="stylesheet" href="./style.overlay.fontsize.all.css">
  <link rel="stylesheet" href="./style.routeoverlay.drag.css">
  <link rel="stylesheet" href="./style.overlay.readability.css">
  <link rel="stylesheet" href="./style.routeoverlay.modern.css">
  <link rel="stylesheet" href="./style.mobile.compact.css">
</head>
<body>
  <div id="map"></div>

  <!-- 現在地表示（ドラッグ可） -->
  <div id="currentLocation">
    <img id="flag" alt="flag">
    <div id="currentText">
      <span id="currentCountry">日本 (JP)</span>
      <span id="currentCity">神戸</span>
    </div>
  </div>

  <!-- モバイルバー（コンパクト/メニュー） -->
  <div id="mobileBar"><div class="mb-left"><span class="mb-title">TRAVEL MAP</span><button id="toggleCompact">コンパクト</button><button id="toggleMenu">メニュー表示/非表示</button></div></div>

  <!-- 配信インジケータ & SafeFrame -->
  <div id="streamIndicator"><span class="dot"></span> LIVE</div>
  <div id="safeFrame"><div class="sf" data-sf="title"></div><div class="sf" data-sf="action"></div></div>

  <!-- OBS Route Overlay -->
  <div id="routeOverlay">
    <div class="ro-head"><div class="ro-title">ROUTE</div><div id="roProgress" class="ro-progress">0/0</div></div>
    <div class="ro-main">
      <div class="ro-block">
        <div class="ro-line1"><div class="ro-label">NOW</div><div id="roNowCity" class="ro-value">-</div></div>
        <div class="ro-line2"><img id="roNowFlag" class="ro-flag" alt="flag"><div id="roNowCountry" class="ro-country">-</div></div>
      </div>
      <div class="ro-block">
        <div class="ro-line1"><div class="ro-label">FROM</div><div id="roFromCity" class="ro-value">-</div></div>
        <div class="ro-line2"><img id="roFromFlag" class="ro-flag" alt="flag"><div id="roFromCountry" class="ro-country">-</div></div>
      </div>
      <div id="roHistory" class="ro-history"></div>
    </div>
  </div>

  <!-- メニュー（折り畳み、Redoなし） -->
  <div id="ui">
    <div id="uiDragHandle" title="ドラッグで移動">⋮⋮</div>
    <button id="langBtn">日本語</button>
    <button id="streamBtn">配信モード</button>

    <details class="ui-group"><summary class="ui-title">現在の状態</summary>
      <button id="exportBtn">現在の状態を保存</button>
      <button id="importBtn">保存した状態を読み込み</button>
      <input id="importFile" type="file" accept="application/json" style="display:none">
    </details>

    <!-- ルート（検索を最上段へ） -->
    <details class="ui-group"><summary class="ui-title">ルート</summary>
      <!-- 検索を最上段へ配置 -->
      <div class="searchWrap" style="margin-bottom:8px;">
        <input id="citySearch" placeholder="都市名・国名で検索">
        <div id="cityResults" class="city-results"></div>
      </div>

      <!-- 地域／国セレクト -->
      <select id="regionSelect"><option value="">地域</option></select>
      <select id="countrySelect"><option value="">国</option></select>
<div class="stateWrap" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
  <select id="stateSelect"><option value="">州</option></select>
</div>

      <!-- 都市セレクト／操作 -->
      <select id="citySelect"><option value="">都市</option></select>
      <button id="addBtn">追加</button>
      <button id="undoBtn">ひとつ戻す</button>
      <button id="cancelInsertBtn">挿入解除</button>
      <div>挿入モード: <span id="insertModeLabel">OFF</span></div>
      <ol id="routeList" class="route-list"></ol>
      <button id="resetHistoryBtn" class="danger">ルート履歴をリセット</button>
    </details>

    <details class="ui-group"><summary class="ui-title">地図</summary>
      <select id="mapStyleSelect">
        <option value="osm">標準</option>
        <option value="bw">白黒</option>
        <option value="sat">衛星</option>
        <option value="topo">地形</option>
      </select>
      <button id="toggleBorders">国境色分け ON/OFF</button>
    </details>

    <details class="ui-group"><summary class="ui-title">現在地</summary>
      <label><input id="showLocation" type="checkbox" checked> 現在地表示</label>
      <button id="lockLocationBtn">位置ロック: OFF</button>
      <label class="col"><span>現在地サイズ</span><input id="currentMarkerSize" type="range" min="8" max="60" value="20"></label>
      <label class="col"><span>現在地テキストサイズ</span><input id="locFontSize" type="range" min="12" max="40" value="18"></label>
      <label class="col"><span>旗サイズ</span><input id="locFlagSize" type="range" min="12" max="96" value="24"></label>
      <label class="col"><span>パディング</span><input id="locPadding" type="range" min="4" max="40" value="10"></label>
      <label class="col"><span>ルート線の色</span><input id="lineColor" type="color" value="#ff3333"></label>
      <label class="col"><span>ルート線の太さ</span><input id="lineWeight" type="range" min="1" max="12" value="4"></label>
      <label class="col"><span>現在地マーカー色</span><input id="currentMarkerColor" type="color" value="#00ffff"></label>
      <label class="col"><span>過去マーカー色</span><input id="pastMarkerColor" type="color" value="#ff3333"></label>
    </details>

    <details class="ui-group"><summary class="ui-title">ルートオーバーレイ</summary>
      <label><input id="showRouteOverlay" type="checkbox" checked> オーバーレイ表示</label>
      <label class="col"><span>オーバーレイ文字サイズ</span><input id="overlayFontSize" type="range" min="12" max="40" value="18"></label>
      <label class="col"><span>国旗サイズ</span><input id="overlayFlagSize" type="range" min="12" max="96" value="22"></label>
      <label><input id="overlayOnlyInStream" type="checkbox"> 配信モード中のみ表示</label>
      <label><input id="obsSafeFrame" type="checkbox"> セーフフレーム表示（見切れ確認）</label>
      <!-- 見やすさ（不透明度／背景透過／行間） -->
      <label class="col"><span>オーバーレイ不透明度</span>
        <input id="overlayOpacity" type="range" min="0.60" max="1.00" step="0.01" value="1.00">
      </label>
      <label class="col"><span>背景の透過度</span>
        <input id="overlayBgAlpha" type="range" min="0.30" max="0.90" step="0.01" value="0.62">
      </label>
      <label class="col"><span>行間（ラインハイト）</span>
        <input id="overlayLineHeight" type="range" min="1.00" max="1.50" step="0.01" value="1.10">
      </label>
    </details>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./app.js"></script>
<script src="./js/fix-currentlocation-drag.js"></script>
  <script src="./js/draggable-ui.js"></script>
  <script src="./js/extensions.js"></script>
  <!-- Safe add-ons (app.jsは不変のまま機能追加) -->
  <script src="./js/fix-lineweight.js"></script>
  <script src="./js/draggable-routeoverlay.js"></script>
  <script src="./js/overlay-fontsize.all.js"></script>
  <script src="./js/overlay-readability.js"></script>
  <script src="./js/mobile-compact.js"></script>
  <script src="./js/mobile-icons.js"></script>
</body>
</html>
