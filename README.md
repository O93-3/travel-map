# Travel Map（旅行ルート可視化マップ）

**旅行で訪れた都市を、地図上の「ルート線 + マーカー」で記録**していくシンプルなWebアプリです。最後に追加した都市は **「現在地」** として強調表示され、配信向けの **ルートオーバーレイ** も用意しています。  
（保存はブラウザのローカル領域に入るので、アカウント登録など不要です）

---

## 起動
- 起動URL： https://o93-3.github.io/travel-map/

---

## できること（ざっくり）
- 都市を検索して追加 → ルート線が伸びる
- 「ひとつ戻す」で直近の追加を取り消し
- 国境色分けのON/OFF（見た目が映える）
- 配信モード（UIを消して地図だけに）
- ルートオーバーレイ（OBS等に載せる用の表示）

---

## 主な機能（推しポイント）

### 1) 地図表示・地図スタイル切替
- 標準 / 白黒 / 衛星 / 地形 の4種類を切り替え可能
- 一度選んだ地図スタイルは次回起動でも自動で復元

### 2) ルート作成（訪問履歴）
- 都市を追加すると、地図にマーカーを置き、ルート線（polyline）を更新
- 直前と同じ都市を連打しても追加しない安全設計
- 「ひとつ戻す」で直近の追加を取り消し

### 3) 都市検索（早い・迷わない）
- 「都市 / 国を検索…」で候補が出ます（最大30件）
- クリックでセレクトが連動し、そのまま追加まで一気に進められます
- キーボード：↑/↓で候補移動、Enterで確定追加、Escで閉じる

### 4) 現在地（テロップ + 強調マーカー）
- 最後に追加した都市を「現在地」として強調
- 画面上部に現在地テロップを表示（国名 / 都市名）
- 国コードがある場合は国旗も表示（サイズはUIで調整）
- **安定版では、現在地テロップをドラッグしても形が崩れないように改善済み**

### 5) 見た目のカスタマイズ（配信映え）
- ルート線の色 / 太さ
- 現在地マーカー色 / 過去マーカー色
- 現在地テロップの 文字サイズ / 旗サイズ / パディング
- ルートオーバーレイの 文字サイズ / 国旗サイズ / 不透明度 / 背景透過 / 行間

### 6) 配信モード（ワンボタンでスッキリ）
- 配信モードにすると、UIパネルを非表示にして地図を広く使えます
- 解除は **Escキー**

### 7) ルートオーバーレイ（OBS向け）
- ルート進行（0/0）、NOW / FROM、国旗、履歴リストを表示
- 「配信モード中のみ表示」「セーフフレーム表示（見切れ確認）」にも対応

### 8) モバイル対応（コンパクトUI）
- 画面が狭いときはコンパクト表示
- 上部のモバイルバーから「コンパクト」「メニュー表示/非表示」を操作可能

### 9) 別タブ同期
- 別タブで更新しても、storageイベントで表示が追従します

---

## 実はこんな機能も（地味に便利）
- **現在地の位置ロック**：ドラッグを固定して誤操作防止
- **状態の保存/読み込み（エクスポート/インポート）**：
  ルート履歴や見た目設定をJSONとして保存し、別PCへ移すこともできます
- **ルート編集（挿入モード）**：途中に都市を差し込む運用ができます

---

## 使い方（最短）
1. 検索欄に都市名/国名を入力
2. 候補をクリック（または ↑/↓ + Enter）
3. 自動で追加され、ルート線が伸びます
4. 間違えたら「ひとつ戻す」

---

## 保存について（重要）
このアプリは、**保存が各PC（各ブラウザ）に保存**されます。
- ルート履歴：`travelHistory`
- 地図スタイル：`mapStyle`
- 国境表示：`bordersOn`
- 色やサイズ：`lineColor`, `currentColor`, `pastColor`, `curSize`, `locFontSize`, `locFlagSize`, `locPadding`
- テロップ位置：`locUI`

---

## ファイル構成（最低限）
- `index.html`, `style.css`, `app.js`
- `cities.json`（都市データ）
- `countries.geojson`（国境色分け）
- `sw.js`（PWA/キャッシュ）

---

## PWA / Service Worker（sw.js）について
- オフライン寄りに使えるよう、主要ファイルをキャッシュします
- 更新後に表示が変わらないときは、ブラウザの **「再読み込み（強制）」** を試してください

---

## トラブルシューティング
- **地図が真っ白 / 動かない**：ブラウザのConsoleでエラーが出ていないか確認
- **更新が反映されない**：強制更新 → だめならサイトデータ/キャッシュ削除
- **検索候補が出ない**：`cities.json` が同じ場所にあるか確認

---

## 変更履歴
- 安定版：現在地テロップのドラッグで形が崩れないように改善

