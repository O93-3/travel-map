起動はここから→https://o93-3.github.io/travel-map/
※保存は各PCに保存されます。verUP後などはキャッシュ等消さないといけないかもかも。
UI戻らない等あれば右クリ「最新の状態に更新」試してみてください。

--------------------------------------------------------------------------------------------
Travel Map（旅行ルート可視化マップ）
旅行で訪れた都市を 地図上のルート（線）＋マーカーで記録し、現在地（最後に追加した都市）を強調表示するシンプルなWebアプリです。
都市データ（cities.json）を読み込み、検索→追加の流れでルートを作れます。

1. 主な機能一覧
1) 地図表示・地図スタイル切替

Leaflet で地図を表示し、初期表示は世界全体（[20,0] / zoom 2）です。
地図スタイルは 標準 / 白黒 / 衛星 / 地形を切り替えできます（OSM / Carto / ArcGIS / OpenTopoMap のタイル）。 

選んだ地図スタイルは localStorage の mapStyle に保存され、次回起動時に復元されます。

2) 国境色分け（GeoJSON）ON/OFF

countries.geojson を読み込み、国ごとに色分けしたレイヤーを表示できます。
ON/OFF状態は localStorage の bordersOn に保存され、次回起動時に復元されます。

3) ルート（訪問履歴）の作成：追加・ひとつ戻す

都市を「追加」すると、地図上にマーカーを置き、ルート線（polyline）を更新します。
直前と同じ都市を連打してしまう誤操作を防ぐため、直前と同一都市なら追加しない制御があります。
「ひとつ戻す」で直近の追加を取り消し、マーカーとルート線を更新します。
履歴は localStorage の travelHistory に保存され、次回起動時に復元します。

4) 都市検索（検索欄＋候補リスト）

「都市 / 国を検索…」入力で候補が表示されます。
検索は 国名・都市名（日本語/英語）・国コードなどを対象にし、NFKC正規化＋小文字化で揺れに強い比較をしています。 
候補は最大30件表示で、現在地（最後に追加した都市）または地図中心からの距離も使って並び替え（近い順優先）します。 
候補クリックで 地域→国→都市のセレクトを連動更新し、そのまま追加（addBtn.click()）まで行います。
キーボード操作：

↑/↓ で候補移動、Enter で確定追加、Esc で閉じます。


5) 現在地（テロップ＋脈動マーカー）

最後に追加した都市を「現在地」として扱い、地図上に 脈動（pulsate）アイコンを表示します。
画面上部に「Now Traveling」テロップ（国名/都市名）を表示し、都市名は太字・大きめのデザインになっています。 
国コードがある場合は FlagCDNの画像URLを生成して国旗を表示します（サイズはUI値に追従）。

6) 見た目のカスタマイズ（色・サイズ）

ルート線の色（lineColor）を変更できます（localStorageに保存、polylineの色を更新）。
現在地マーカー色（currentColor）を変更できます（最新マーカー＋現在地脈動も更新）。
過去マーカー色（pastColor）を変更できます（最新以外のマーカーに反映）。
現在地マーカーのサイズ（curSize）を変更できます。
現在地テロップの 文字サイズ/旗サイズ/パディングを変更し、localStorage に保存されます。

7) UI（折り畳み＋スクロール）

UIは <details>/<summary> を使った 折り畳みセクション構成です。
メニューが画面外に伸びても、UIパネル内だけスクロールするように #ui に max-height と overflow-y:auto が入っています。 

8) 配信モード

「配信モード」で UIパネル(#ui)を非表示にできます。
Escape キーで配信モードを解除します。

9) 現在地テロップのドラッグ移動

現在地テロップ（#currentLocation）はドラッグ可能で、位置を localStorage の locUI に保存します。 

10) 別タブ同期（storageイベント）

別タブや別プロセスで travelHistory が更新された場合、storage イベントで受けて 表示を再構築します。


2. 画面の操作手順（基本フロー）

検索欄に都市名/国名を入力 → 候補が出ます。
候補をクリック（または ↑/↓ + Enter）→ 自動で追加され、ルート線が伸びます。
間違えたら「ひとつ戻す」で直近を取り消します。
見た目（色/サイズ）を調整すると、即時反映され次回も保持されます。


3. データと保存先
ローカル保存（localStorage）
以下を localStorage に保存して復元します：

ルート履歴：travelHistory 
地図スタイル：mapStyle
国境表示ON/OFF：bordersOn
ルート線の色：lineColor
現在地/過去マーカー色：currentColor, pastColor
現在地マーカーサイズ：curSize
現在地テロップ設定：locFontSize, locFlagSize, locPadding
テロップ位置：locUI 

必要ファイル

index.html, style.css, app.js（UI/ロジック）
cities.json（都市データ）
countries.geojson（国境色分け）


4. PWA / Service Worker（sw.js）について
sw.js がある場合、index.html / style.css / app.js / cities.json などをキャッシュし、キャッシュ優先で返す挙動になります。
キャッシュ名は travel-map-v1 で、install時に FILES の一覧を追加し、fetch時は caches.match() があればそれを返します。 


5. トラブルシューティング
地図が真っ白 / 動かない

app.js が途中でエラー停止すると、地図初期化やイベントが動きません（Consoleを確認）。
もし sw.js を使っている場合、古いキャッシュが残って更新が反映されないことがあります（Service Worker を解除/キャッシュ削除を検討）。 

検索候補が出ない

cities.json の読み込みができていない可能性があります（同一ディレクトリ配置を確認）

6. 変更履歴（書き足し用）


# ✅ OBSオーバーレイ（いちばん簡単：サーバー不要／一般向け）

本プロジェクトのオーバーレイは `travelHistory`（localStorage）を参照します。
**普段のブラウザ（Chrome/Edge）で操作した内容を、そのままオーバーレイに反映**させたい場合は、
OBSの「ブラウザソース」を使わず、**ウィンドウキャプチャ＋クロマキー（緑抜き）**が最も簡単で安定します。

## 使うページ（緑抜き版）
- カード：`overlay-card-key.html`（320×192）
- ミニマップ：`overlay-map-key.html`（480×255）

> ※ GitHub Pages は HTTPS で配信されるため、PWA/アプリ化の前提条件を満たします。> （`file://`直開きでの“インストール”確認はできないため、配布は GitHub Pages 推奨です。）

## 手順（3分）
1. **同じブラウザ（Chrome か Edge）**で、次を開きます。
   - Travel Map（操作用）：`/index.html`
   - オーバーレイ（カード緑抜き）：`/overlay-card-key.html`
   - オーバーレイ（ミニマップ緑抜き）：`/overlay-map-key.html`

2. 可能なら、`overlay-*-key.html` を **「アプリとしてインストール」**（または「ショートカット作成 → ウィンドウとして開く」）してください。
   - 目的：アドレスバーやタブを消して、OBS側の切り抜きを最小にするため。

3. OBSに取り込みます。
   - ソース → **ウィンドウキャプチャ**（2つ作る：カード用／ミニマップ用）
   - それぞれのソースに **フィルタ → クロマキー**
     - キーカラー：**緑**（Key Color Type: Green）
     - まずは既定値のまま、輪郭が荒い場合だけ Similarity/Smoothness を少し調整

4. Travel Map 側で都市を追加します。
   - 2地点以上追加すると、カード/ミニマップが更新されます。

## よくある失敗
- **別ブラウザで開いている**（例：操作はChrome、オーバーレイはEdge）
  - localStorage が共有されず、更新されません。
- **同じブラウザでもプロファイルが別**（ゲスト/別プロファイル）
  - 同様に共有されません。

